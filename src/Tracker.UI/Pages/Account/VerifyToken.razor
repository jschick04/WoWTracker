@page "/account/verify"

@attribute [AllowAnonymous]

@code {

    protected override async Task OnInitializedAsync()
    {
        var token = NavigationManager.QueryString("token");

        if (string.IsNullOrWhiteSpace(token))
        {
            ToastService.ShowError("Invalid Token");
            return;
        }

        var api = $"{ApiRoutes.Account.VerifyEmail}?token={token}";

        var result = await HttpClient.PostAsync(api, null);

        if (result.IsSuccessStatusCode)
        {
            ToastService.ShowSuccess("Account successfully verified");
        }
        else
        {
            var response = await result.Content.ReadFromJsonAsync<ErrorResponse>();
            ToastService.ShowError(response?.Error);
        }

        NavigationManager.NavigateTo("/");
    }

}